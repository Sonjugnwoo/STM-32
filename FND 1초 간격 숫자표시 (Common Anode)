/* USER CODE BEGIN Header */
/* USER CODE END Header */

/* Private includes ----------------------------------------------------------*/
/* USER CODE BEGIN Includes */
#include <main.h>  // STM32 HAL 라이브러리 메인 헤더 (CubeMX 자동 생성)
/* USER CODE END Includes */

/* Private includes ----------------------------------------------------------*/
/* USER CODE BEGIN Includes */
/* 사용자 추가 헤더 파일 영역 */
/* USER CODE END Includes */

/* Private typedef -----------------------------------------------------------*/
/* USER CODE BEGIN PTD */
/* 사용자 정의 타입 영역 */
/* USER CODE END PTD */

/* Private define ------------------------------------------------------------*/
/* USER CODE BEGIN PD */
/* 사용자 정의 상수/매크로 영역 */
/* USER CODE END PD */

/* Private macro -------------------------------------------------------------*/
/* USER CODE BEGIN PM */
  #define SET_IF(expr) ((expr) ? GPIO_PIN_SET : GPIO_PIN_RESET)     /* 7세그먼트 제어 매크로: 비트1→ON(SET), 비트0→OFF(RESET) */
/* USER CODE END PM */

/* Private variables ---------------------------------------------------------*/
/* 전역 변수 영역 */
/* USER CODE BEGIN PV */
/* 사용자 전역 변수 영역 */
/* USER CODE END PV */

/* Private function prototypes -----------------------------------------------*/
void SystemClock_Config(void);     // 시스템 클럭 설정
static void MX_GPIO_Init(void);    // GPIO 초기화 (PD10~15 출력)
/* USER CODE BEGIN PFP */
/* 사용자 함수 프로토타입 영역 */
/* USER CODE END PFP */

/* Private user code ---------------------------------------------------------*/
/* USER CODE BEGIN 0 */
/* 사용자 정의 함수 영역 */
/* USER CODE END 0 */

int main(void){
  /* USER CODE BEGIN 1 */

  /* FND2 세그먼트 핀 배열 (GPIOE - 실제 사용) */
  int FND2[8] = {GPIO_PIN_8, GPIO_PIN_9, GPIO_PIN_3, GPIO_PIN_2, GPIO_PIN_7, GPIO_PIN_13, GPIO_PIN_14, GPIO_PIN_4};
  /* 세그먼트 순서: a,b,c,d,e,f,g,dp (일반적 배치) */
  
  /* 0~9 숫자별 7세그먼트 패턴 (공통음극, 0=세그먼트ON) */
  int da[10] = {0xC0, 0xF9, 0xA4, 0xB0, 0x99, 0x92, 0x82, 0xF8, 0x80, 0x90};
  /* 0xC0=0, 0xF9=1, 0xA4=2, 0xB0=3, 0x99=4, 0x92=5, 0x82=6, 0xF8=7, 0x80=8, 0x90=9 */
  
  int i, j;  // 루프 변수
  /* USER CODE END 1 */

  /* ========== MCU 기본 초기화 ========= */
  HAL_Init();           // HAL 라이브러리, Systick, Flash 초기화
  SystemClock_Config(); // 시스템 클럭 설정 (CubeMX 자동)
  MX_GPIO_Init();       // GPIOE 출력 모드 설정 (FND 제어용)

  /* ========== 0~9 무한 카운터 ========= */
  while (1)
  {
    /* 외부 루프: 0~9 숫자 반복 */
    for(j = 0; j < 10; j++)
    {
      /* 내부 루프: 각 숫자의 8비트 세그먼트 제어 */
      for(i = 0; i < 8; i++) 
      {
        /* da[j]의 i번째 비트가 1이면 해당 세그먼트 점등 */
        HAL_GPIO_WritePin(GPIOE, FND2[i], SET_IF(da[j] & (1<<i)));
      }
      HAL_Delay(1000);  // 각 숫자 1초씩 표시
    }
    /* 0→1→2→...→9 → 다시 0부터 반복 */
  }
}